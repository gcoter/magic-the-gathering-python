schema: '2.0'
stages:
  collect_data:
    cmd: "python scripts/run_competition_between_players.py --n_games 1000 --player_classes
      random,random --params_path params.yaml --game_logs_dataset_path data/game_logs_dataset.pickle
      --evaluation_metrics_json_path results/metrics/collect_data.json\n"
    deps:
    - path: data/basic_land_cards.csv
      md5: 64b65f2ffffe186aa55a8b32b77647e8
      size: 497714
    - path: data/vanilla_creature_cards.csv
      md5: 954695af44c0a4041cca760fd8134d49
      size: 138286
    - path: magic_the_gathering/actions/base.py
      md5: d62482db18bc7681547077c51d7015c2
      size: 5693
    - path: magic_the_gathering/actions/cast_card.py
      md5: 9f140a32ec3b8f829c72fc48912c5e08
      size: 2679
    - path: magic_the_gathering/actions/deal_damage.py
      md5: 5b1a6e313dfda9ce1287e964f25f6ae5
      size: 4877
    - path: magic_the_gathering/actions/declare_attacker.py
      md5: ff0a9a8ae6566c10d3c2e98e9660f206
      size: 2423
    - path: magic_the_gathering/actions/declare_blocker.py
      md5: 5fcb1b6638a8bf3e995d1161d6c63021
      size: 2553
    - path: magic_the_gathering/actions/draw.py
      md5: e344e7592de064475d02aeea080b646f
      size: 1686
    - path: magic_the_gathering/actions/kill_player.py
      md5: 3f5dd710fd9cbf6c5b8818be79505659
      size: 925
    - path: magic_the_gathering/actions/move_to_graveyard.py
      md5: 1daffe21c408b7a9dc52ff291dbf9a64
      size: 1169
    - path: magic_the_gathering/actions/none.py
      md5: dbfbdf395e2b599e29d4d6b6a2c7f9d0
      size: 219
    - path: magic_the_gathering/actions/pass_to_next_player.py
      md5: b5211fa0777ba52fdc0c7db545cc193b
      size: 598
    - path: magic_the_gathering/actions/play_land.py
      md5: 0be730b64f3235f9302d151008e06f9b
      size: 2242
    - path: magic_the_gathering/actions/resolve_stack.py
      md5: 118af7f6d17adf7d1ea02837bae67248
      size: 1076
    - path: magic_the_gathering/actions/shuffle.py
      md5: 313524193825647a9b26d86aab67d51d
      size: 1347
    - path: magic_the_gathering/actions/tap.py
      md5: f3f379a30bbf38f01fe0cab9d87fc2fb
      size: 1721
    - path: magic_the_gathering/actions/untap.py
      md5: eb52d922625c416c1b02ed5c1453b0f7
      size: 2552
    - path: magic_the_gathering/cards/base.py
      md5: da8f2877d3191b9ffdf44a06a990b7c1
      size: 7598
    - path: magic_the_gathering/cards/deck_creator.py
      md5: 0328d2fda31d5c1f059c1f35bef94dc5
      size: 3671
    - path: magic_the_gathering/cards/state.py
      md5: 1c251a39ebbc2aaa48585db632367b84
      size: 1288
    - path: magic_the_gathering/game_engine.py
      md5: ccbfe8906bee120793fc5e989ddc2443
      size: 1758
    - path: magic_the_gathering/game_logs_dataset.py
      md5: dade94bc2c69187d4b529b75ffa1a7ba
      size: 6272
    - path: magic_the_gathering/game_modes/base.py
      md5: 70216b155a64165cb8bf8a9fc4fcd8a9
      size: 437
    - path: magic_the_gathering/game_modes/default.py
      md5: 053cb301b19380808efe7660b87a91b2
      size: 259
    - path: magic_the_gathering/game_state.py
      md5: 1fed89061b3fc30f03592d4bce8eb371
      size: 10443
    - path: magic_the_gathering/phases/base.py
      md5: 53629da810f5b243262bbf8e3de5a227
      size: 602
    - path: magic_the_gathering/phases/beginning.py
      md5: c15c1816223f015feb9562a3de4a0c5b
      size: 824
    - path: magic_the_gathering/phases/combat_beginning.py
      md5: 3fa5df67e941c7dc539352764eea6600
      size: 383
    - path: magic_the_gathering/phases/combat_damage.py
      md5: fef49b4aad68eadaf0a1bec13265b79e
      size: 634
    - path: magic_the_gathering/phases/combat_declare_attackers.py
      md5: dfc37bf6948e4ab8d77a2daf9b99abfa
      size: 2064
    - path: magic_the_gathering/phases/combat_declare_blockers.py
      md5: 805f5b47b9054092b73bf8e6f3e8a6a5
      size: 2961
    - path: magic_the_gathering/phases/combat_end.py
      md5: 58899289bd65758b372cd8c27322f7ee
      size: 491
    - path: magic_the_gathering/phases/draw.py
      md5: a6e15eda17557361aa0c597fdeb04b95
      size: 516
    - path: magic_the_gathering/phases/end.py
      md5: ece917b39b89264c6b1832883f47f64d
      size: 906
    - path: magic_the_gathering/phases/main.py
      md5: a2964322eea3a368bb6db562dfb3a86a
      size: 2565
    - path: magic_the_gathering/phases/mulligan.py
      md5: d6f9ee42ec8193f1c3596aefae361f35
      size: 2269
    - path: magic_the_gathering/phases/players_get_priority.py
      md5: f729e8ef9eff2041e63c0523318395aa
      size: 654
    - path: magic_the_gathering/phases/untap.py
      md5: 6c1b40ba388a9d8deb71b6d88fe1a8ed
      size: 437
    - path: magic_the_gathering/phases/upkeep.py
      md5: 15af8bfbff635d7bd11713718fb1e346
      size: 327
    - path: magic_the_gathering/players/base.py
      md5: e1f9018c35626872fa56a441cdf76a14
      size: 2665
    - path: magic_the_gathering/players/random.py
      md5: 33c63d1d7888c7877b4f5c8200b4619e
      size: 368
    - path: magic_the_gathering/turn.py
      md5: db8503ace93b2a3760baf818c00a2ffc
      size: 2016
    - path: scripts/run_competition_between_players.py
      md5: 16ebc687d02e92f3cf2756177696897a
      size: 6853
    outs:
    - path: data/game_logs_dataset.pickle
      md5: 43b60bbedcbc40a86e8e0c3f6fde6d68
      size: 3104208439
    - path: results/metrics/collect_data.json
      md5: 5bc0551b74a8f13d5cf4387151f1749f
      size: 176
  train_deep_learning_scorer:
    cmd: "python scripts/train_deep_learning_scorer.py --params_path params.yaml --game_logs_dataset_path
      data/game_logs_dataset.pickle --model_folder_path results/models/ --model_file_name
      deep_learning_scorer\n"
    deps:
    - path: data/game_logs_dataset.pickle
      md5: 43b60bbedcbc40a86e8e0c3f6fde6d68
      size: 3104208439
    - path: magic_the_gathering/game_logs_dataset.py
      md5: dade94bc2c69187d4b529b75ffa1a7ba
      size: 6272
    - path: magic_the_gathering/players/deep_learning_based/single_action_scorer/dataset.py
      md5: b1a6e05c19730190a345dc4add9e0e02
      size: 11798
    - path: 
        magic_the_gathering/players/deep_learning_based/single_action_scorer/models/base.py
      md5: 6de9c3368053b98feffd14d3df884543
      size: 9473
    - path: 
        magic_the_gathering/players/deep_learning_based/single_action_scorer/models/v2.py
      md5: d900593149330163fc15679d03b3bfc3
      size: 14560
    - path: scripts/train_deep_learning_scorer.py
      md5: 2a3f4d38db543aeefcbf2dec5b0b1e99
      size: 4834
    params:
      params.yaml:
        deep_learning_scorer:
          hyper_parameters:
            game_state_global_dim: 2
            n_players: 2
            player_dim: 8
            max_n_zone_vectors: 120
            zone_vector_dim: 34
            action_general_dim: 31
            max_n_action_source_cards: 10
            max_n_action_target_cards: 10
            action_history_length: 5
            embedding_dim: 64
            transformer_n_layers: 2
            transformer_n_heads: 8
            transformer_dim_feedforward: 128
            dropout: 0.1
          training:
            random_split:
              training_size: 0.8
              validation_size: 0.2
            batch_size: 100
            n_epochs: 1000
            model_checkpoint:
              monitor: validation_loss
              mode: min
              save_top_k: 1
              verbose: false
            early_stopping:
              monitor: validation_loss
              mode: min
              patience: 10
              verbose: false
    outs:
    - path: results/models//deep_learning_scorer.ckpt
      md5: 20ab27218f401e6a095ea1ce9b6f04b4
      size: 2620357
  evaluate_deep_learning_player:
    cmd: "python scripts/run_competition_between_players.py --n_games 1000 --player_classes
      random,deep_learning --params_path params.yaml --evaluation_metrics_json_path
      results/metrics/evaluate_deep_learning_player.json --game_logs_stats_json_path
      results/metrics/game_logs_stats_after_evaluation.json --deep_learning_scorer_path
      results/models//deep_learning_scorer.ckpt\n"
    deps:
    - path: data/basic_land_cards.csv
      md5: 64b65f2ffffe186aa55a8b32b77647e8
      size: 497714
    - path: data/vanilla_creature_cards.csv
      md5: 954695af44c0a4041cca760fd8134d49
      size: 138286
    - path: magic_the_gathering/actions/base.py
      md5: d62482db18bc7681547077c51d7015c2
      size: 5693
    - path: magic_the_gathering/actions/cast_card.py
      md5: 9f140a32ec3b8f829c72fc48912c5e08
      size: 2679
    - path: magic_the_gathering/actions/deal_damage.py
      md5: 5b1a6e313dfda9ce1287e964f25f6ae5
      size: 4877
    - path: magic_the_gathering/actions/declare_attacker.py
      md5: ff0a9a8ae6566c10d3c2e98e9660f206
      size: 2423
    - path: magic_the_gathering/actions/declare_blocker.py
      md5: 5fcb1b6638a8bf3e995d1161d6c63021
      size: 2553
    - path: magic_the_gathering/actions/draw.py
      md5: e344e7592de064475d02aeea080b646f
      size: 1686
    - path: magic_the_gathering/actions/kill_player.py
      md5: 3f5dd710fd9cbf6c5b8818be79505659
      size: 925
    - path: magic_the_gathering/actions/move_to_graveyard.py
      md5: 1daffe21c408b7a9dc52ff291dbf9a64
      size: 1169
    - path: magic_the_gathering/actions/none.py
      md5: dbfbdf395e2b599e29d4d6b6a2c7f9d0
      size: 219
    - path: magic_the_gathering/actions/pass_to_next_player.py
      md5: b5211fa0777ba52fdc0c7db545cc193b
      size: 598
    - path: magic_the_gathering/actions/play_land.py
      md5: 0be730b64f3235f9302d151008e06f9b
      size: 2242
    - path: magic_the_gathering/actions/resolve_stack.py
      md5: 118af7f6d17adf7d1ea02837bae67248
      size: 1076
    - path: magic_the_gathering/actions/shuffle.py
      md5: 313524193825647a9b26d86aab67d51d
      size: 1347
    - path: magic_the_gathering/actions/tap.py
      md5: f3f379a30bbf38f01fe0cab9d87fc2fb
      size: 1721
    - path: magic_the_gathering/actions/untap.py
      md5: eb52d922625c416c1b02ed5c1453b0f7
      size: 2552
    - path: magic_the_gathering/cards/base.py
      md5: da8f2877d3191b9ffdf44a06a990b7c1
      size: 7598
    - path: magic_the_gathering/cards/deck_creator.py
      md5: 0328d2fda31d5c1f059c1f35bef94dc5
      size: 3671
    - path: magic_the_gathering/cards/state.py
      md5: 1c251a39ebbc2aaa48585db632367b84
      size: 1288
    - path: magic_the_gathering/game_engine.py
      md5: ccbfe8906bee120793fc5e989ddc2443
      size: 1758
    - path: magic_the_gathering/game_logs_dataset.py
      md5: dade94bc2c69187d4b529b75ffa1a7ba
      size: 6272
    - path: magic_the_gathering/game_modes/base.py
      md5: 70216b155a64165cb8bf8a9fc4fcd8a9
      size: 437
    - path: magic_the_gathering/game_modes/default.py
      md5: 053cb301b19380808efe7660b87a91b2
      size: 259
    - path: magic_the_gathering/game_state.py
      md5: 1fed89061b3fc30f03592d4bce8eb371
      size: 10443
    - path: magic_the_gathering/phases/base.py
      md5: 53629da810f5b243262bbf8e3de5a227
      size: 602
    - path: magic_the_gathering/phases/beginning.py
      md5: c15c1816223f015feb9562a3de4a0c5b
      size: 824
    - path: magic_the_gathering/phases/combat_beginning.py
      md5: 3fa5df67e941c7dc539352764eea6600
      size: 383
    - path: magic_the_gathering/phases/combat_damage.py
      md5: fef49b4aad68eadaf0a1bec13265b79e
      size: 634
    - path: magic_the_gathering/phases/combat_declare_attackers.py
      md5: dfc37bf6948e4ab8d77a2daf9b99abfa
      size: 2064
    - path: magic_the_gathering/phases/combat_declare_blockers.py
      md5: 805f5b47b9054092b73bf8e6f3e8a6a5
      size: 2961
    - path: magic_the_gathering/phases/combat_end.py
      md5: 58899289bd65758b372cd8c27322f7ee
      size: 491
    - path: magic_the_gathering/phases/draw.py
      md5: a6e15eda17557361aa0c597fdeb04b95
      size: 516
    - path: magic_the_gathering/phases/end.py
      md5: ece917b39b89264c6b1832883f47f64d
      size: 906
    - path: magic_the_gathering/phases/main.py
      md5: a2964322eea3a368bb6db562dfb3a86a
      size: 2565
    - path: magic_the_gathering/phases/mulligan.py
      md5: d6f9ee42ec8193f1c3596aefae361f35
      size: 2269
    - path: magic_the_gathering/phases/players_get_priority.py
      md5: f729e8ef9eff2041e63c0523318395aa
      size: 654
    - path: magic_the_gathering/phases/untap.py
      md5: 6c1b40ba388a9d8deb71b6d88fe1a8ed
      size: 437
    - path: magic_the_gathering/phases/upkeep.py
      md5: 15af8bfbff635d7bd11713718fb1e346
      size: 327
    - path: magic_the_gathering/players/base.py
      md5: e1f9018c35626872fa56a441cdf76a14
      size: 2665
    - path: magic_the_gathering/players/deep_learning_based/base_scorer.py
      md5: 061962c74002d34e75e0720d62ff5fbc
      size: 398
    - path: magic_the_gathering/players/deep_learning_based/player.py
      md5: 5006a18ea7c9d33947e84100c41f68b8
      size: 1307
    - path: magic_the_gathering/players/deep_learning_based/single_action_scorer/dataset.py
      md5: b1a6e05c19730190a345dc4add9e0e02
      size: 11798
    - path: 
        magic_the_gathering/players/deep_learning_based/single_action_scorer/models/base.py
      md5: 6de9c3368053b98feffd14d3df884543
      size: 9473
    - path: 
        magic_the_gathering/players/deep_learning_based/single_action_scorer/models/v2.py
      md5: d900593149330163fc15679d03b3bfc3
      size: 14560
    - path: magic_the_gathering/turn.py
      md5: db8503ace93b2a3760baf818c00a2ffc
      size: 2016
    - path: results/models//deep_learning_scorer.ckpt
      md5: 20ab27218f401e6a095ea1ce9b6f04b4
      size: 2620357
    - path: scripts/run_competition_between_players.py
      md5: 16ebc687d02e92f3cf2756177696897a
      size: 6853
    params:
      params.yaml:
        deep_learning_scorer:
          hyper_parameters:
            game_state_global_dim: 2
            n_players: 2
            player_dim: 8
            max_n_zone_vectors: 120
            zone_vector_dim: 34
            action_general_dim: 31
            max_n_action_source_cards: 10
            max_n_action_target_cards: 10
            action_history_length: 5
            embedding_dim: 64
            transformer_n_layers: 2
            transformer_n_heads: 8
            transformer_dim_feedforward: 128
            dropout: 0.1
          training:
            random_split:
              training_size: 0.8
              validation_size: 0.2
            batch_size: 100
            n_epochs: 1000
            model_checkpoint:
              monitor: validation_loss
              mode: min
              save_top_k: 1
              verbose: false
            early_stopping:
              monitor: validation_loss
              mode: min
              patience: 10
              verbose: false
    outs:
    - path: results/metrics/evaluate_deep_learning_player.json
      md5: 1e918f82ff828846609b944b36dde571
      size: 178
    - path: results/metrics/game_logs_stats_after_evaluation.json
      md5: 6dbee49dde3d0c3fbae20eb98225bd83
      size: 975
  compute_game_logs_stats:
    cmd: "python scripts/compute_game_logs_stats.py --game_logs_dataset_path data/game_logs_dataset.pickle
      --metrics_json_path results/metrics/game_logs_stats_after_data_collection.json\n"
    deps:
    - path: data/game_logs_dataset.pickle
      md5: 43b60bbedcbc40a86e8e0c3f6fde6d68
      size: 3104208439
    - path: magic_the_gathering/actions/base.py
      md5: d62482db18bc7681547077c51d7015c2
      size: 5693
    - path: magic_the_gathering/game_logs_dataset.py
      md5: dade94bc2c69187d4b529b75ffa1a7ba
      size: 6272
    - path: scripts/compute_game_logs_stats.py
      md5: 1d7ae2af667ed51267c18b4a6b0523e8
      size: 819
    outs:
    - path: results/metrics/game_logs_stats_after_data_collection.json
      md5: b305c613d299f3c6fb046274fcdc9a1b
      size: 976
